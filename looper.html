<!DOCTYPE html>
<!-- Consider specifying the language of your content by adding the `lang` attribute to <html> -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">

    <title>Test</title>
    <meta name="description" content="">

    <!-- Mobile viewport optimized: h5bp.com/viewport -->
    <meta name="viewport" content="width=device-width">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/jquery-ui-1.9.2.custom.min.css">

    <!-- Processing.js -->
    <script type="text/javascript" src="js/processing-1.4.1.min.js"></script>
    <!-- JQuery 1.8 -->
    <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
    <!-- JQuery UI 1.9 -->
    <script src="js/jquery-ui-1.9.2.custom.min.js"></script>
    <!-- My code -->
    <script type="text/javascript" src="js/visualizer.js"></script>
    <script type="text/javascript" src="js/looper.js"></script>
    <script type="text/javascript" src="js/song_loader.js"></script>
</head>
<body>
    <div id="toolbar" class="clearfix">
        <div id="show-settings">Show Metronome Options</div>
        <div id="save">Save Song</div>
    </div>
    <div id="settings">
        
    </div>
    <div id="canvas-container">
        <div id="blank-start-container">
            <h1>Welcome!</h1>
            <p>This tool is experimental and still very much in-progress.
                Pick a tempo and get started!</p>
            <div id="tempo-value">120</div>
            <div id="slider-tempo"></div>
            <div class="start-button" onclick="javascript:startRecording('metronome')" data-mode="metronome">Start recording</div>
        </div>
        <div id="load-song-start-container">
            <h1>Welcome!</h1>
            <p>This tool is experimental and still very much in-progress.
                You're listening to a song someone created.</p>
            <div class="start-button" onclick="javascript:loadSong()" data-mode="metronome">Play</div>
        </div>
        <canvas id="canvas" width="960" height="600"></canvas>
        <div id="after-save-container">
            <h1></h1>
            <p>Saving...</p>
            <div class="button"></div>
        </div>
	</div>
    <script src="js/controls-setup.js" type="text/javascript"></script>
    <script src="js/base64.js" type="text/javascript"></script>
    <script>
        var testdata = {
            "this is": "a test"
        }
        //use the button to test shit
        $('#save').click(function(){
            var asc = $("#after-save-container");
            var cv = $('#canvas');
            asc.css({
                top: (cv.height()/2) - (asc.height()/2),
                left: (cv.width()/2) - (asc.width()/2)
            });
            asc.show();
            $.ajax({
                type: "POST",
                url: "http://do.robertvinluan.com:1337/datadump",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(decircularizeAll()),
                success: function(data) {
                    console.log("success!");
                    console.log("id returned: " + data);
                    asc.find('h1').text("Song Saved!");
                    asc.find('p').text("Here's your unique url: http://robertvinluan.com/songsquares/looper.html?s="+data);
                    asc.find('.button').text("OK").click(function(){
                        $(this).hide();
                    });
                    asc.css({
                        top: (cv.height()/2) - (asc.height()/2),
                        left: (cv.width()/2) - (asc.width()/2)
                    });
                },
                error: function(){
                    console.log("error");
                }
            });
        })

        $('body').on('keydown', function(e){
            if(e.keyCode == 48) { //0
                $.ajax({
                    type: "GET",
                    url: "http://do.robertvinluan.com:1337/load",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data) {
                        for(i in data) {
                            var s = new SoundObject();
                            s.importFromJSON(data[i]);
                            console.log(s);
                            soundObjects.push(s);
                        }
                    },
                    error: function(data) {
                        console.log("error bro");
                    }
                })
            }
        });
    </script>
</body>
</html>